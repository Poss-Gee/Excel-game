<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game for My Love ‚ù§Ô∏è</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #1a202c;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }
        .grid {
            display: grid;
            gap: 10px;
            margin-top: 20px;
            width: 100%;
            max-width: 450px;
        }
        .card {
            width: 100%;
            aspect-ratio: 1;
            background-color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            background-size: cover;
            background-position: center;
            transition: transform 0.3s;
        }
        .hidden {
            background-image: url('back.jpg');
            background-color: #2d3748;
        }
        .revealed {
            transform: rotateY(180deg);
        }
        .menu {
            text-align: center;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background-color: yellow;
            color: #1a202c;
        }
        .timer {
            margin-top: 10px;
            font-size: 18px;
            display: none;
        }
        .timer.blink {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            50% { color: red; }
        }
        .progress {
            margin-top: 10px;
            font-size: 18px;
        }
        .scores {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
        }
        .scores div {
            font-size: 20px;
        }
        .confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #2d3748;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            color: white;
            width: 80%;
            max-width: 400px;
        }
        .modal-buttons button {
            margin: 10px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 25px;
            background-color: #ffcc00;
            color: #1a202c;
            transition: transform 0.2s;
        }
        .modal-buttons button:hover {
            transform: scale(1.05);
        }
        .coin-shop {
            margin: 20px 0;
            padding: 15px;
            background-color: #4a5568;
            border-radius: 10px;
        }
        #gameOverModal .modal-content {
            background-color: #e53e3e; /* Red background for game over */
        }
        #gameOverModal h2 {
            color: white;
        }
        @media (max-width: 600px) {
            .grid {
                gap: 5px;
                max-width: 90%; /* Reduce max-width for smaller screens */
            }
            .card {
                border-radius: 5px;
                min-width: 60px; /* Minimum card size */
                min-height: 60px;
            }
            button {
                font-size: 14px;
                padding: 8px 12px;
            }
            .scores div {
                font-size: 16px;
            }
            .modal-content {
                width: 90%; /* Make modal wider on small screens */
                padding: 20px; /* Reduce padding */
            }
            .modal-buttons button {
                padding: 10px 20px; /* Adjust button padding */
                font-size: 14px;
            }
            h1 {
                font-size: 24px; /* Reduce heading size */
            }
            .progress {
                font-size: 16px; /* Reduce progress text size */
            }
            .timer {
                font-size: 16px; /* Reduce timer text size */
            }
        }

        @media (max-width: 400px) {
            .card {
                min-width: 50px; /* Further reduce card size for very small screens */
                min-height: 50px;
            }
            .modal-content {
                width: 95%; /* Make modal even wider */
                padding: 15px; /* Further reduce padding */
            }
            .modal-buttons button {
                padding: 8px 16px; /* Further adjust button padding */
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>Possi_Excel ‚ù§Ô∏èü•∞</h1>
    <div class="menu" id="menu">
        <button onclick="startGame('single')">Single Player</button>
        <button onclick="startGame('multi')">Multiplayer</button>
    </div>
    <button id="pauseBtn" onclick="togglePause()" style="display:none;">Pause</button>
    <button id="backBtn" onclick="location.reload()" style="display:none;">Back</button>
    <button id="hintBtn" onclick="useHint()" style="display:none;">Hint (3)</button>
    <button id="revealBtn" onclick="useRevealAll()" style="display:none;">Reveal All (1)</button>
    <div class="timer" id="timer">Time: 0s</div>
    <div class="scores" id="scores" style="display:none;">
        <div>Player 1: <span id="player1Score">0</span></div>
        <div>Player 2: <span id="player2Score">0</span></div>
    </div>
    <div class="progress" id="progress">Stars: ‚òÖ‚òÖ‚òÖ | Coins: 0üí∞</div>
    <div class="grid" id="gameBoard"></div>
    <canvas id="confetti-canvas" class="confetti-canvas"></canvas>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <h2>Game Over! üò¢</h2>
            <p>You ran out of time!</p>
            <div class="modal-buttons">
                <button id="playAgainBtn">Play Again</button>
            </div>
        </div>
    </div>

    <!-- Level Complete Modal -->
    <div id="levelCompleteModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Level Complete! üéâ</h2>
            <div id="modalMessage">
                <div style="font-size: 24px; margin: 15px 0;">
                    <span id="modalStars"></span>
                    <span id="modalCoins"></span>
                </div>
                <div class="coin-shop">
                    <h3>Coin Shop üí∞</h3>
                    <p>Total Coins: <span id="totalCoinsDisplay">0</span></p>
                    <button onclick="buyHint()">Buy Hint (30 coins)</button>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="nextLevelBtn">Next Level</button>
                <button id="playAgainBtn2">Play Again</button>
            </div>
        </div>
    </div>

    <audio id="backgroundMusic" src="romantic-music.mp3" loop></audio>
    <audio id="correctSound" src="correct.mp3"></audio>
    <audio id="wrongSound" src="wrong.mp3"></audio>
    <audio id="winSound" src="win.mp3"></audio>
    <script>
        const allImages = ["Babe1.jpg", "babe2.jpg","babe4.jpg", "babe5.jpg","babe7.jpg","babe8.jpg","babe9.jpg","babe10.jpg"];
        let images = [];
        let cards = [];
        let selectedCards = [];
        let matchedPairs = 0;
        let timer;
        let timeElapsed = 0;
        let gamePaused = false;
        let hintsLeft = 3;
        let revealAllLeft = 1;
        let currentLevel = 1;
        let gridRows = 4;
        let gridCols = 3;
        let isMultiplayer = false;
        let currentPlayer = 1;
        let player1Score = 0;
        let player2Score = 0;
        let totalCoins = 0;
        let currentLevelCoins = 0;

        // Maximum time limits for each level
        const maxTimeLimits = {
            1: 65, // Level 1: 65 seconds
            2: 75, // Level 2: 75 seconds
            3: 85, // Level 3: 85 seconds
        };

        // Modal elements
        const gameOverModal = document.getElementById("gameOverModal");
        const levelCompleteModal = document.getElementById("levelCompleteModal");
        const modalTitle = document.getElementById("modalTitle");
        const modalMessage = document.getElementById("modalMessage");
        const modalStars = document.getElementById("modalStars");
        const modalCoins = document.getElementById("modalCoins");
        const totalCoinsDisplay = document.getElementById("totalCoinsDisplay");
        const nextLevelBtn = document.getElementById("nextLevelBtn");
        const playAgainBtn = document.getElementById("playAgainBtn");
        const playAgainBtn2 = document.getElementById("playAgainBtn2");

        // Event listeners for modal buttons
        playAgainBtn.addEventListener("click", () => {
            gameOverModal.style.display = "none";
            currentLevel = 1;
            startGame(isMultiplayer ? 'multi' : 'single');
        });

        playAgainBtn2.addEventListener("click", () => {
            levelCompleteModal.style.display = "none";
            currentLevel = 1;
            startGame(isMultiplayer ? 'multi' : 'single');
        });

        nextLevelBtn.addEventListener("click", () => {
            levelCompleteModal.style.display = "none";
            if (currentLevel < 3) {
                currentLevel++;
                startGame(isMultiplayer ? 'multi' : 'single');
            } else {
                currentLevel = 1;
                startGame(isMultiplayer ? 'multi' : 'single');
            }
        });

        function startGame(mode) {
            isMultiplayer = mode === 'multi';
            document.getElementById("menu").style.display = "none";
            document.getElementById("pauseBtn").style.display = "inline-block";
            document.getElementById("backBtn").style.display = "inline-block";
            document.getElementById("hintBtn").style.display = "inline-block";
            document.getElementById("revealBtn").style.display = "inline-block";
            document.getElementById("timer").style.display = "block";
            document.getElementById("progress").style.display = "block";
            document.getElementById("scores").style.display = isMultiplayer ? "flex" : "none";

            // Set grid size based on level
            if (currentLevel === 1) {
                gridRows = 4;
                gridCols = 3;
            } else if (currentLevel === 2) {
                gridRows = 4;
                gridCols = 4;
            } else if (currentLevel === 3) {
                gridRows = 5;
                gridCols = 4;
            }

            document.getElementById("gameBoard").style.gridTemplateColumns = `repeat(${gridCols}, 1fr)`;

            const totalCards = gridRows * gridCols;
            images = allImages.slice(0, totalCards / 2);
            cards = [...images, ...images];
            cards.sort(() => Math.random() - 0.5);
            document.getElementById("gameBoard").innerHTML = "";
            cards.forEach((image, index) => createCard(image, index));
            alert(`Level ${currentLevel}: You have 5 seconds to memorize the pictures!`);
            revealCardsTemporarily();
            timeElapsed = 0;
            document.getElementById("timer").innerText = `Time: ${timeElapsed}s`;
            hintsLeft = 3;
            revealAllLeft = 1;
            document.getElementById("hintBtn").innerText = `Hint (${hintsLeft})`;
            document.getElementById("revealBtn").innerText = `Reveal All (${revealAllLeft})`;
            document.getElementById("backgroundMusic").play();
            currentPlayer = 1;
            player1Score = 0;
            player2Score = 0;
            updateScores();
        }

        function createCard(image, index) {
            const card = document.createElement("div");
            card.classList.add("card", "hidden");
            card.dataset.image = image;
            card.dataset.index = index;
            card.addEventListener("click", () => flipCard(card));
            document.getElementById("gameBoard").appendChild(card);
        }

        function revealCardsTemporarily() {
            document.querySelectorAll('.card').forEach(card => {
                card.style.backgroundImage = `url(${card.dataset.image})`;
            });
            setTimeout(() => {
                document.querySelectorAll('.card:not(.revealed)').forEach(card => {
                    card.style.backgroundImage = "url('back.jpg')";
                });
                startTimer();
            }, 5000);
        }

        function flipCard(card) {
            if (card.classList.contains("revealed") || selectedCards.length === 2 || gamePaused) return;
            card.style.backgroundImage = `url(${card.dataset.image})`;
            selectedCards.push(card);
            
            if (selectedCards.length === 2) {
                setTimeout(() => {
                    const [card1, card2] = selectedCards;
                    if (card1.dataset.image === card2.dataset.image) {
                        card1.classList.add("revealed");
                        card2.classList.add("revealed");
                        matchedPairs++;
                        if (isMultiplayer) {
                            if (currentPlayer === 1) {
                                player1Score++;
                            } else {
                                player2Score++;
                            }
                            updateScores();
                        }
                        document.getElementById("correctSound").play();
                        showHearts();
                    } else {
                        card1.style.backgroundImage = "url('back.jpg')";
                        card2.style.backgroundImage = "url('back.jpg')";
                        document.getElementById("wrongSound").play();
                        if (isMultiplayer) {
                            currentPlayer = currentPlayer === 1 ? 2 : 1; // Switch turns
                        }
                    }
                    selectedCards = [];

                    if (matchedPairs === images.length) {
                        handleLevelCompletion();
                    }
                }, 1000);
            }
        }

        function handleLevelCompletion() {
            clearInterval(timer);
            setTimeout(() => {
                document.getElementById("winSound").play();
                showConfetti();
                
                const stars = calculateStars();
                currentLevelCoins = calculateCoins();
                totalCoins += currentLevelCoins;

                // Update modal display
                modalTitle.innerText = `Level ${currentLevel} Completed! üéâ`;
                modalStars.innerHTML = `${stars}<br>`;
                modalCoins.innerHTML = `Coins Earned: ${currentLevelCoins}üí∞`;
                totalCoinsDisplay.innerText = totalCoins;
                levelCompleteModal.style.display = "flex";

                // Update progress display
                document.getElementById("progress").innerHTML = `
                    Hints: ${hintsLeft} 
                    | Coins: ${totalCoins}üí∞
                `;
            }, 500);
        }

        function checkTimeLimit() {
            if (timeElapsed >= maxTimeLimits[currentLevel]) {
                clearInterval(timer);
                gameOverModal.style.display = "flex"; // Show Game Over modal
            }
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                if (!gamePaused) {
                    timeElapsed++;
                    document.getElementById("timer").innerText = `Time: ${timeElapsed}s`;

                    // Make timer blink red when time is running out
                    let blinkTime;
                    if (currentLevel === 1) {
                        blinkTime = 60;
                    } else if (currentLevel === 2) {
                        blinkTime = 70;
                    } else if (currentLevel === 3) {
                        blinkTime = 80;
                    }

                    if (timeElapsed > blinkTime) {
                        document.getElementById("timer").classList.add("blink");
                    }

                    // Check if time is up
                    checkTimeLimit();
                }
            }, 1000);
        }

        function calculateStars() {
            let maxTime = maxTimeLimits[currentLevel];
            if (timeElapsed <= maxTime - 25) {
                return "‚òÖ‚òÖ‚òÖ";
            } else if (timeElapsed <= maxTime - 15) {
                return "‚òÖ‚òÖ";
            } else {
                return "‚òÖ";
            }
        }

        function calculateCoins() {
            let maxTime = maxTimeLimits[currentLevel];
            if (timeElapsed <= maxTime - 25) {
                return 50;
            } else if (timeElapsed <= maxTime - 15) {
                return 40;
            } else {
                return 30;
            }
        }

        function updateScores() {
            document.getElementById("player1Score").innerText = player1Score;
            document.getElementById("player2Score").innerText = player2Score;
        }

        function togglePause() {
            gamePaused = !gamePaused;
            document.getElementById("pauseBtn").innerText = gamePaused ? "Resume" : "Pause";
        }

        function useHint() {
            if (hintsLeft > 0) {
                hintsLeft--;
                document.getElementById("hintBtn").innerText = `Hint (${hintsLeft})`;
                const unrevealedCards = Array.from(document.querySelectorAll('.card:not(.revealed)'));
                const cardMap = new Map();
                for (const card of unrevealedCards) {
                    const image = card.dataset.image;
                    if (cardMap.has(image)) {
                        const firstCard = cardMap.get(image);
                        const secondCard = card;
                        firstCard.style.backgroundImage = `url(${image})`;
                        secondCard.style.backgroundImage = `url(${image})`;
                        setTimeout(() => {
                            if (!firstCard.classList.contains("revealed")) {
                                firstCard.style.backgroundImage = "url('back.jpg')";
                            }
                            if (!secondCard.classList.contains("revealed")) {
                                secondCard.style.backgroundImage = "url('back.jpg')";
                            }
                        }, 1000);
                        break;
                    } else {
                        cardMap.set(image, card);
                    }
                }
            }
        }

        function buyHint() {
            if (totalCoins >= 30) {
                totalCoins -= 30;
                hintsLeft += 1;
                totalCoinsDisplay.innerText = totalCoins;
                document.getElementById("hintBtn").innerText = `Hint (${hintsLeft})`;
                document.getElementById("progress").innerHTML = `
                    Hints: ${hintsLeft} 
                    | Coins: ${totalCoins}üí∞
                `;
            } else {
                alert("Not enough coins! Earn more by completing levels faster!");
            }
        }

        function useRevealAll() {
            if (revealAllLeft > 0) {
                revealAllLeft--;
                document.getElementById("revealBtn").innerText = `Reveal All (${revealAllLeft})`;
                document.querySelectorAll('.card:not(.revealed)').forEach(card => {
                    card.style.backgroundImage = `url(${card.dataset.image})`;
                });
                setTimeout(() => {
                    document.querySelectorAll('.card:not(.revealed)').forEach(card => {
                        card.style.backgroundImage = "url('back.jpg')";
                    });
                }, 2000); // Reveal all for 2 seconds
            }
        }

        function showConfetti() {
            const confettiSettings = { target: 'confetti-canvas', max: 150 };
            const confetti = new ConfettiGenerator(confettiSettings);
            confetti.render();
            setTimeout(() => confetti.clear(), 5000); // Stop after 5 seconds
        }

        function showHearts() {
            const heart = document.createElement("div");
            heart.innerText = "‚ù§Ô∏è";
            heart.style.position = "absolute";
            heart.style.fontSize = "30px";
            heart.style.left = `${Math.random() * 100}vw`;
            heart.style.top = `${Math.random() * 100}vh`;
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1000);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
</body>
</html>
